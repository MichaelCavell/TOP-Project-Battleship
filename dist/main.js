(()=>{"use strict";class e{constructor(e,t=0,n=!1){this.length=e,this.hits=t,this.sunk=n}hit(){this.hits<this.length&&(this.hits++,this.isSunk())}isSunk(){return this.length<=this.hits&&(this.sunk=!0,!0)}}class t{constructor(){this.rows=10,this.columns=10,this.board=this.newBoard()}newBoard(){return Array.from({length:this.rows},(()=>Array.from({length:this.columns},(()=>null))))}placeShip(t,n,r){const o=new e(n);let[a,l]=t;if(this.fitCheck(t,n,r)){if("horizontal"===r)for(let e=0;e<n;e++)this.board[a][l]=o,l++;if("vertical"===r)for(let e=0;e<n;e++)this.board[a][l]=o,a++;return o}return"we're gonna need a smaller boat"}fitCheck(t,n,r){let[o,a]=t;if("horizontal"===r){if(n>this.board.length-a)return!1;for(let t=0;t<n;t++){if(this.board[o][a]instanceof e)return!1;a++}return!0}if("vertical"===r){if(n>this.board.length-o)return!1;for(let t=0;t<n;t++){if(this.board[o][a]instanceof e)return!1;o++}return!0}}receiveAttack(t){const[n,r]=t,o=this.board[n][r];return o instanceof e?(o.hit(),this.board[n][r]="hit","hit"):"hit"===o||"miss"===o?"not a valid attack":(this.board[n][r]="miss",this.board[n][r])}allShipsSunk(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++){const r=this.board[t][n];if(r instanceof e&&!r.isSunk())return!1}return!0}getBoardState(){return this.board.map((e=>e.slice()))}computerPlaceShip(e){let t,n,r;do{t=Math.floor(10*Math.random()),n=Math.floor(10*Math.random()),r=Math.random()<.5?"horizontal":"vertical"}while(!this.fitCheck([t,n],e,r));return this.placeShip([t,n],e,r)}}class n{constructor(){this.playerTurn=!0,this.gameboard=new t}switchTurn(){this.playerTurn=!1}attack(e,t,n){n.receiveAttack([e,t]),this.switchTurn(),"hit"===n.board[e][t]&&this.updateRecentHit(e,t)}computerPlayerTurn(e){let t;return t=this.recentHit?this.tryAdjacentSlots(this.recentHit,e.board):this.generateRandomCoordinate(e.board),this.attack(t[0],t[1],e),`attacked${t}`}tryAdjacentSlots(e,t){const[n,r]=e,o=[[n-1,r],[n+1,r],[n,r-1],[n,r+1]];for(const[e,n]of o)if(e>=0&&e<10&&n>=0&&n<10&&"hit"!==t[e][n]&&"miss"!==t[e][n])return[e,n];return this.generateRandomCoordinate(t)}generateRandomCoordinate(e){const t=e.length;let n,r;do{n=Math.floor(Math.random()*t),r=Math.floor(Math.random()*t)}while("hit"===e[n][r]||"miss"===e[n][r]);return[n,r]}updateRecentHit(e,t){this.recentHit=[e,t]}}const r=new class{constructor(){this.playerOne=new n,this.computerPlayer=new n,this.computerCarrier=this.computerPlayer.gameboard.computerPlaceShip(5),this.computerBattleship=this.computerPlayer.gameboard.computerPlaceShip(4),this.computerCruiser=this.computerPlayer.gameboard.computerPlaceShip(3),this.computerSubmarine=this.computerPlayer.gameboard.computerPlaceShip(3),this.computerDestroyer=this.computerPlayer.gameboard.computerPlaceShip(2)}};function o(){const e=r.playerOne.gameboard.getBoardState();document.getElementById("player-heading").innerText="Player Board",function(e,t){e.innerHTML="";for(let n=0;n<t.length;n++)for(let r=0;r<t[n].length;r++){const o=document.createElement("h2");o.classList.add("cell");const a=t[n][r];o.innerText=`${n}, ${r}`,o.setAttribute("data-row",n),o.setAttribute("data-col",r),null===a?o.style.backgroundColor="lightblue":"miss"===a?o.style.backgroundColor="white":"hit"===a?o.style.backgroundColor="red":(o.style.backgroundColor="grey",o.innerText=""),e.appendChild(o)}}(document.getElementById("player-board"),e)}let a=0;function l(){const e=document.getElementById("carrier-row"),t=document.getElementById("carrier-col"),n=document.getElementById("carrier-orientation").value,l=document.getElementById("carrier-div"),i=parseInt(e.value,10),d=parseInt(t.value,10);r.playerOne.gameboard.fitCheck([i,d],5,n)&&(r.playerOne.gameboard.placeShip([i,d],5,n),o(),a++,l.innerHTML="",a>=5&&u())}function i(){const e=document.getElementById("battleship-row"),t=document.getElementById("battleship-col"),n=document.getElementById("battleship-orientation").value,l=document.getElementById("battleship-div"),i=parseInt(e.value,10),d=parseInt(t.value,10);r.playerOne.gameboard.fitCheck([i,d],4,n)&&(r.playerOne.gameboard.placeShip([i,d],4,n),o(),a++,l.innerHTML="",a>=5&&u())}function d(){const e=document.getElementById("cruiser-row"),t=document.getElementById("cruiser-col"),n=document.getElementById("cruiser-orientation").value,l=document.getElementById("cruiser-div"),i=parseInt(e.value,10),d=parseInt(t.value,10);r.playerOne.gameboard.fitCheck([i,d],3,n)&&(r.playerOne.gameboard.placeShip([i,d],3,n),o(),a++,l.innerHTML="",a>=5&&u())}function c(){const e=document.getElementById("submarine-row"),t=document.getElementById("submarine-col"),n=document.getElementById("submarine-orientation").value,l=document.getElementById("submarine-div"),i=parseInt(e.value,10),d=parseInt(t.value,10);r.playerOne.gameboard.fitCheck([i,d],3,n)&&(r.playerOne.gameboard.placeShip([i,d],3,n),o(),a++,l.innerHTML="",a>=5&&u())}function s(){const e=document.getElementById("destroyer-row"),t=document.getElementById("destroyer-col"),n=document.getElementById("destroyer-orientation").value,l=document.getElementById("destroyer-div"),i=parseInt(e.value,10),d=parseInt(t.value,10);r.playerOne.gameboard.fitCheck([i,d],2,n)&&(r.playerOne.gameboard.placeShip([i,d],2,n),o(),a++,l.innerHTML="",a>=5&&u())}function u(){const t=r.playerOne.gameboard.getBoardState(),n=r.computerPlayer.gameboard.getBoardState(),o=document.getElementById("player-board");document.getElementById("player-heading").innerText="Player Board",function(e,t){e.innerHTML="";for(let n=0;n<t.length;n++)for(let r=0;r<t[n].length;r++){const o=document.createElement("h2");o.classList.add("cell");const a=t[n][r];o.setAttribute("data-row",n),o.setAttribute("data-col",r),null===a?o.style.backgroundColor="lightblue":"miss"===a?o.style.backgroundColor="white":"hit"===a?o.style.backgroundColor="red":(o.style.backgroundColor="grey",o.innerText=""),e.appendChild(o)}}(o,t);const a=document.getElementById("computer-board");document.getElementById("computer-heading").innerText="Computer Board",function(e,t){e.innerHTML="";for(let n=0;n<t.length;n++)for(let r=0;r<t[n].length;r++){const o=document.createElement("div");o.classList.add("cell");const a=t[n][r];o.setAttribute("data-row",n),o.setAttribute("data-col",r),o.style.backgroundColor=null===a?"lightblue":"miss"===a?"white":"hit"===a?"red":"lightblue",e.appendChild(o)}}(a,n);const l=document.getElementById("scoreboard"),i=document.getElementById("carrier"),d=document.getElementById("battleship"),c=document.getElementById("cruiser"),s=document.getElementById("submarine"),u=document.getElementById("destroyer"),h=m(),p=function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=r.computerPlayer.gameboard.board[t][n];if(o instanceof e&&4===o.length)return"Battleship"}return"Battleship SUNK"}(),g=function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=r.computerPlayer.gameboard.board[t][n];if(o instanceof e&&3===o.length)return o.id="Cruiser","Cruiser"}return"Cruiser SUNK"}(),y=function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=r.computerPlayer.gameboard.board[t][n];if(o instanceof e&&3===o.length&&"Cruiser"!==o.id)return o.id="Submarine","Submarine"}return"Submarine SUNK"}(),b=function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=r.computerPlayer.gameboard.board[t][n];if(o instanceof e&&2===o.length)return"Destroyer"}return"Destroyer SUNK"}();l.innerText="Computer Ships",i.innerText=`${h}`,d.innerText=`${p}`,c.innerText=`${g}`,s.innerText=`${y}`,u.innerText=`${b}`}function m(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=r.computerPlayer.gameboard.board[t][n];if(o instanceof e&&5===o.length)return"Carrier"}return"Carrier SUNK"}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("carrier-row"),t=document.getElementById("carrier-col"),n=document.getElementById("placeCarrierButton");for(let n=0;n<10;n++){const r=document.createElement("option");r.value=n,r.text=n,e.appendChild(r);const o=document.createElement("option");o.value=n,o.text=n,t.appendChild(o)}n.addEventListener("click",l)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("battleship-row"),t=document.getElementById("battleship-col"),n=document.getElementById("placeBattleshipButton");for(let n=0;n<10;n++){const r=document.createElement("option");r.value=n,r.text=n,e.appendChild(r);const o=document.createElement("option");o.value=n,o.text=n,t.appendChild(o)}n.addEventListener("click",i)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("cruiser-row"),t=document.getElementById("cruiser-col"),n=document.getElementById("placeCruiserButton");for(let n=0;n<10;n++){const r=document.createElement("option");r.value=n,r.text=n,e.appendChild(r);const o=document.createElement("option");o.value=n,o.text=n,t.appendChild(o)}n.addEventListener("click",d)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("submarine-row"),t=document.getElementById("submarine-col"),n=document.getElementById("placeSubmarineButton");for(let n=0;n<10;n++){const r=document.createElement("option");r.value=n,r.text=n,e.appendChild(r);const o=document.createElement("option");o.value=n,o.text=n,t.appendChild(o)}n.addEventListener("click",c)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("destroyer-row"),t=document.getElementById("destroyer-col"),n=document.getElementById("placeDestroyerButton");for(let n=0;n<10;n++){const r=document.createElement("option");r.value=n,r.text=n,e.appendChild(r);const o=document.createElement("option");o.value=n,o.text=n,t.appendChild(o)}n.addEventListener("click",s)})),console.log(m()),document.getElementById("computer-board").addEventListener("click",(function(e){if(r.playerOne.gameboard.allShipsSunk()||r.computerPlayer.gameboard.allShipsSunk())return;const t=e.target,n=t.getAttribute("data-row"),o=t.getAttribute("data-col");"miss"!==r.computerPlayer.gameboard.board[n][o]&&"hit"!==r.computerPlayer.gameboard.board[n][o]&&(r.playerOne.attack(n,o,r.computerPlayer.gameboard),u(),r.computerPlayer.gameboard.allShipsSunk()?alert("GAME OVER!"):(r.computerPlayer.computerPlayerTurn(r.playerOne.gameboard),u(),r.playerOne.gameboard.allShipsSunk()&&alert("GAME OVER!")))})),o()})();